@model WatchListViewModel

@{
    //If WatchList is null, then this will evaluate to false - i.e the string will be assigned to "invisible"
    string visibility = Model?.WatchLists?.Count() > 0 ? "visible" : "invisible";

    bool watchListSelected = Model?.WatchListMovies == null ? false : true;
    bool watchListIsEmpty = Model?.WatchListMovies?.Count() == 0 ? true : false;
}

<div class="container-fluid m-2">
    <div class="row">
        <div class="col-4">
            <div class="card text-center border border-2 border-dark">
                <div class="card-body">
                    <h3 class="card-title">Create new watchlist</h3>
                    <a asp-action="CreateWatchList" class="btn btn-primary btn-lg">CREATE</a>
                 </div>
            </div>
            
            <div class="card text-center border border-2 border-dark mt-2 @visibility">
                <div class="card-body">
                    <h3 class="card-title">Select a watchlist</h3>
                    <form method="get" id="selectWatchListForm">
                        <select class="form-select" id="selectWatchList" name="watchListId">
                            <option value="" selected disabled hidden>Select here</option>
                            @foreach (WatchList watchList in Model?.WatchLists ?? Enumerable.Empty<WatchList>())
                            {
                                <option value="@watchList.WatchListId">@watchList.Title</option>
                            }
                        </select>
                    </form>
                </div>
            </div>
        </div>

        <div class="col">
            @if (watchListSelected && !watchListIsEmpty)
            {
                <h2 class="text-dark text-center p-2" style="background-color: gold">
                    <b>@Model?.WatchListMovies?.ElementAt(0)?.WatchList?.Title.ToUpper()</b>
                </h2>
                <h5 class="text-white text-center p-2" style="background-color: black">
                    Movies to watch
                </h5>
                <table class="table table-sm table-striped table-bordered">
                    <thead>
                        <tr>
                            <th id="title">Title</th>
                            <th>Genre</th>
                            <th>MPAA</th>
                        </tr>
                    </thead>
                    <tbody>
                    @foreach (WatchListMovies watchListMovie in Model?.WatchListMovies?.Where(x => x.Watched == false) ?? Enumerable.Empty<WatchListMovies>())
                    {
                        <tr class="test">
                            <td class="hideRow">@watchListMovie.WatchListId</td>
                            <td class="hideRow">@watchListMovie.MovieId</td>
                            <td>@watchListMovie.Movie?.Title</td>
                            <td>@watchListMovie.Movie?.Genre?.Name</td>
                            <td>@watchListMovie.Movie?.Mpaa?.Title</td>
                            <td class="text-center"><button type="button" class="btn btn-primary btn-sm infoclick">Show Info</button></td>
                            <td class="text-center">
                                    <form asp-action="UpdateMovieAsWatched" method="post">
                                    <input type="hidden" name="watchListId" value="@watchListMovie.WatchListId" />
                                    <input type="hidden" name="movieId" value="@watchListMovie.MovieId" />
                                    <button type="submit" class="btn btn-success btn-sm">Set as watched</button>
                                </form>
                            </td>
                        </tr>
                        <tr class="hideRow">
                                <partial name="_InfoPartial" model="@watchListMovie.Movie">
                        </tr>
                    }
                    </tbody>
                </table>

                <h5 class="text-white text-center p-2" style="background-color: black">
                    Movies watched
                </h5>
                <table class="table table-sm table-striped table-bordered">
                    <thead>
                        <tr>
                            <th id="title">Title</th>
                            <th>Genre</th>
                            <th>MPAA</th>
                        </tr>
                    </thead>
                    <tbody class="watchedtable">
                    @foreach (WatchListMovies watchListMovie in Model?.WatchListMovies?.Where(a => a.Watched == true) ?? Enumerable.Empty<WatchListMovies>())
                    {
                        <tr class="test">
                            <td class="hideRow">@watchListMovie.MovieId</td>
                            <td>@watchListMovie.Movie?.Title</td>
                            <td>@watchListMovie.Movie?.Genre?.Name</td>
                            <td>@watchListMovie.Movie?.Mpaa?.Title</td>
                            <td class="text-center"><button type="button" class="btn btn-primary btn-sm infoclick">Show Info</button></td>
                        </tr>
                        <tr class="hideRow">
                            <partial name="_InfoPartial" model="@watchListMovie.Movie">
                        </tr>
                    }
                    </tbody>
                </table>
            }
            else if (watchListIsEmpty)
            {
                <h1>Watchlist is empty</h1>
            }
            else {
                <h1>Please select a watchlist</h1>
            }

        </div>

    </div>
</div>


<script>
    $(document).ready(function () {

        $("#selectWatchList").change(function () {
            $("#selectWatchListForm").submit();
        });

        $(".infoclick").click(function () {
            $(this).parent().parent().siblings().toggle();
            $(this).text($(this).text() == "Hide Info" ? "Show Info" : "Hide Info");
        });

    });
</script>